<html>

<head>
    <!-- <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes" /> -->
    <link rel="stylesheet" href="css/semantic.min.css">
    <link rel="stylesheet" href="css/spectrum.css">
    <link rel="stylesheet" href="css/ui.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.numeric.min.js"></script>
    <script src="js/semantic.min.js"></script>
    <script src="js/spectrum.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/core.js"></script>
    <script src="js/api.js"></script>
    <script src="js/api.calls.js"></script>
    <script src="js/main.js"></script>
    <script src="js/bp.js"></script>
    <script>
    var _drivers = null;
    var driverPickers = [];

    var _controllers = null;
    var $controller = null;

    var _anims = null;
    var $anims = null;

    function addDriverChooser(params) {
        var id = "driver_" + driverPickers.length;
        $("#driver").append('<div id="' + id + '"></div>');
        $("#driver").append('<div class="ui hidden divider short"></div>');
        var $d = $("#driver").children("#" + id);
        console.log($d);
        $d = $d.param_loader({
            data: _drivers,
            label: "Driver",
            placeholder: "Select Driver...",
            default: "visualizer"
        });
        if (params) {
            $d.val(params);
        }

        driverPickers.push($d);
    }

    function loadAnimOptions(data) {
        $anims = $("#anims").param_loader({
            data: data,
            label: "Animation",
            placeholder: "Select Animation...",
            // default: "matrix"
        });
    }

    function filterAnims(val) {
        loadAnimOptions(_anims[val]);
    }

    function getCurrentConfig() {
        var drivers = [];
        $.each(driverPickers, function(i, d) {
            drivers.push(d.val());
        });
        var cont = $controller.val();

        return {
            drivers: drivers,
            controller: cont
        };
    }

    function getAnimConfig() {
        var config = $anims.val();
        return config;
    }

    $(document)
        .ready(function() {

            $('.menu .item')
                .tab();

            getDrivers(function(drivers) {
                _drivers = drivers;
                addDriverChooser();
            });

            getAnims(function(anims) {
                _anims = anims;
                loadAnimOptions(null);
                getControllers(function(controllers) {
                    _controllers = controllers;
                    $controller = $("#controller").param_loader({
                        data: controllers,
                        label: "Controller",
                        placeholder: "Select Controller...",
                        default: "strip",
                        onChange: filterAnims
                    });


                });
            });


            $('.ui.accordion').accordion({
                exclusive: false
            });

            $("#startDriver").click(function() {

                var config = getCurrentConfig();
                console.log(config);
                config.action = "startConfig"
                callAPI(config, function(result) {
                    console.log(result);
                });
            });

            $("#startAnim").click(function() {

                var params = getAnimConfig();
                callAPI({action: "startAnim", config:params, run:{fps:20}}, function(result) {
                    console.log(result);
                });
            });
        });
    </script>
</head>

<body class="inverted">
    <div class="ui top attached tabular menu">
        <a class="active item" data-tab="config_tab">Config</a>
        <a class="item" data-tab="anim_tab">Animation</a>
        <!--<a class="item" data-tab="third">Third</a> -->
    </div>
    <div class="ui bottom attached active tab segment" data-tab="config_tab">
        <div id="driver"></div>
        <div class="ui hidden divider short"></div>
        <div id="controller"></div>
        <div class="ui hidden divider short"></div>
        <div class="ui button green" id="startDriver">Start</div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="anim_tab">
        <div id="anims"></div>
        <div class="ui hidden divider short"></div>
        <div class="ui button green" id="startAnim">Start Animation</div>
    </div>
    <!--<div class="ui bottom attached tab segment" data-tab="third">
        Third
    </div> -->
</body>

</html>
