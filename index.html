<html>
<head>
 	<meta name="viewport" content ="width=device-width,initial-scale=1,user-scalable=yes" />
	<script src="js/jquery.min.js"></script>
	<script src="js/api.js"></script>
	<script src="js/d3.min.js"></script>
	<script src="js/tinycolor.js"></script>
	<script src="js/colorwheel.js"></script>
	<script src="js/colorwheel.theme.js"></script>
	
	<link rel="stylesheet" href="css/wheel.css">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<div id="colorwheel" class="colorwheel"></div>

	<script> 
		var colorWaiting = false;
		var colorWheel = new ColorWheel(1, '#colorwheel'); 
		colorWheel.colorCallback = function(color){
			console.log(color);
			if(!colorWaiting)
			{
				colorWaiting = true;
				callAPI({action:"setColor", color:color}, function(result){
					colorWaiting = false;
				},
				function(error){
					alert(error);
				});
			}	
		};
		var brightnessWaiting = false;
		function valueMap( value, in_min , in_max , out_min , out_max ) {
		  return ( value - in_min ) * ( out_max - out_min ) / ( in_max - in_min ) + out_min;
		}
		colorWheel.brightnessCallback = function(level){
			level = Math.round(valueMap(level, 0.0, 1.0, 0, 255));
			console.log(level)
			if(!brightnessWaiting)
			{
				brightnessWaiting = true;
				callAPI({action:"setBrightness", level:level}, function(result){
					brightnessWaiting = false;
				},
				function(error){
					alert(error);
				});
			}
		};
	</script>
</body>
</html>