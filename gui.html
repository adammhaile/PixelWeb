<html>

<head>
    <!-- <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes" /> -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.numeric.min.js"></script>
    <script src="js/semantic.min.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/api.js"></script>
    <script src="js/api.calls.js"></script>
    <link rel="stylesheet" href="css/semantic.min.css">
    <script>
    var _drivers = null;
    var _driverControlMap = {};

    function saveDriverParams() {
        var result = {};
        $.each(_driverControlMap, function(k, $n) {
            result[k] = $n.val();
        });

        return result;
    };

    $(document)
        .ready(function() {

            $('.menu .item')
                .tab();

            function insert_int($node, params) {
                return $node._nud({
                    label: params.label,
                    placeholder: params.msg,
                    default: params.default,
                    min: params.min,
                    max: params.max,
                    step: params.step
                });
            }

            function insert_str($node, params) {
                return $node._input({
                    label: params.label,
                    placeholder: params.msg,
                    default: params.default,
                });
            }

            function insert_combo($node, params) {
                return $node._dropdown({
                    label: params.label,
                    placeholder: params.msg,
                    default: params.default,
                    data: params.options
                });
            }

            var insertFuncs = {
                "int": insert_int,
                "str": insert_str,
                "combo": insert_combo
            }

            function showParams($node, params) {
                $node.empty();
                $.each(params, function(i, v) {
                    $node.append('<div class="ui hidden divider"></div>');
                    $($node.append('<div id="' + v.id + '"></div>'));
                    $n = $node.children("#" + v.id);
                    _driverControlMap[v.id] = insertFuncs[v.type]($n, v);
                });
            }

            function driverChanged(id, val) {
                showParams($("#param_controls"), _drivers[val].params);
            }

            var d = $("#driver_selection")._dropdown({
                //data: drivers,
                label: "Driver",
                placeholder: "Select Driver...",
                //default: "serial",
                onChange: driverChanged
            });

            getDrivers(function(drivers) {
                _drivers = drivers;
                var d = {};
                $.each(drivers, function(k, v) {
                    d[k] = v.display;
                });
                $("#driver_selection")._dropdown().load(d);
            });
        });
    </script>
</head>

<body class="inverted">
    <div class="ui top attached tabular menu">
        <a class="active item" data-tab="config">Config</a>
        <a class="item" data-tab="second">Second</a>
        <a class="item" data-tab="third">Third</a>
    </div>
    <div class="ui bottom attached active tab segment" data-tab="config">
        <div id="driver_selection"></div>
        <div id="param_controls"></div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="second">
        Second
    </div>
    <div class="ui bottom attached tab segment" data-tab="third">
        Third
    </div>
</body>

</html>
